<p-confirmDialog></p-confirmDialog>

<div class="contiendescripcion">
  <div class="volver">
    <i class="pi pi-arrow-left" (click)="volver()">Atrás</i>
  </div>
  <div class="product-detail-container" *ngIf="Detalles && !isLoading">
    <div class="product-img">
      <!-- Contador de imágenes (añadido) -->
      <div class="image-counter">
        {{ (Detalles.imagenes?.indexOf(mainImageUrl) || 0) + 1 }} / {{ Detalles.imagenes?.length || 0 }}
      </div>

      <!-- Thumbnail images (original) -->
      <div class="thumbnail-images">
        <ng-container *ngIf="Detalles.imagenes">
          <img *ngFor="let image of Detalles.imagenes; let i = index" [src]="image" alt="Thumbnail"
            (mouseenter)="onThumbnailHover(image)" (mouseleave)="resetMainImage()" (click)="changeMainImage(image)"
            [class.selected]="image === mainImageUrl" class="thumbnail" />
        </ng-container>
      </div>
      <!-- Product images (original con botón añadido) -->
      <div class="product-images" style="position: relative;">
        <img #mainImage *ngIf="mainImageUrl" [src]="mainImageUrl" alt="Product Main Image" class="main-image"
          (click)="openModal()" (mousemove)="applyZoomEffect($event)" (mouseleave)="resetZoomEffect()" />

        <!-- Botón de favoritos (añadido) -->
        <button class="favorite-button" (click)="toggleFavorite($event)">
          <svg [class.favorite-active]="esFavorito" viewBox="0 0 24 24">
            <path
              d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Carrusel para móviles -->
    <div class="image-carousel" *ngIf="!isLoading && Detalles.imagenes">
      <p-galleria [value]="images" [activeIndex]="selectedImageIndex" [showIndicators]="true" [showThumbnails]="false"
        [responsiveOptions]="responsiveOptions" [circular]="true" class="styled-galleria"
        (activeIndexChange)="onImageChange($event)">
        <ng-template pTemplate="item" let-item>
          <img [src]="item.itemImageSrc" class="carousel-image" alt="Product Image" />
        </ng-template>
      </p-galleria>

      <!-- Botones de navegación -->
      <button class="carousel-nav left" (click)="prevImage()">
        <i class="pi pi-chevron-left"></i>
      </button>
      <button class="carousel-nav right" (click)="nextImage()">
        <i class="pi pi-chevron-right"></i>
      </button>
    </div>

    <!-- informacion del producto -->
    <div class="product-info" data-aos="zoom-in-down">
      <h1 class="product-name">{{ Detalles.nombre }}</h1>

      <div *ngIf="Detalles.disponible" class="availability disponible">
        <i class="fas fa-store"></i>
        <span>Disponible para
          {{ Detalles.opcionesTipoTransaccion}}
        </span>
      </div>




      <!-- 🚨 Mostrar mensaje si el producto no está disponible -->
      <div class="availability" *ngIf="!Detalles.disponible">
        <i class="pi pi-exclamation-triangle"></i>
        <span>La renta para este producto o la publicación está pausada.</span>
      </div>
      <div class="contenidoTExt">
        <div class="price-content">

          <p class="price">$MX{{ Detalles.precioActual }}</p>
          <p *ngIf="Detalles.mostrarPrecioAnterior" class="old-price">$MX{{ Detalles.precioAnterior }}</p>
        </div>

        <div *ngIf="Detalles.nuevo" class="new-label">
          <i class="fas fa-tag"></i>
          <span>¡Nuevo!</span>
        </div>
      </div>
      <div class="contenidoTExt">
        <div class="price-content">
          <span *ngIf="Detalles.mostrarPrecioAnterior && Detalles.precioAnterior > Detalles.precioActual"
            class="discount-badge">
            {{ calcularDescuento(Detalles.precioAnterior, Detalles.precioActual) }}% OFF
          </span>
          <span *ngIf="Detalles.mostrarPrecioAnterior && Detalles.precioAnterior > Detalles.precioActual"
            class="savings-message">
            ¡Ahorras MX$ {{ Detalles.precioAnterior - Detalles.precioActual | currency }}!
          </span>
        </div>

      </div>
      <!-- Opciones del producto -->
      <div class="product-options">
        <h2>Acerca de este producto</h2>
        <!-- Detalles del producto -->
        <div class="product-detail">
          <p><strong>Talla:</strong> <span>{{ Detalles.talla }}</span></p>
        </div>
        <div class="product-detail">
          <p><strong>Color:</strong> <span>{{ Detalles.color }}</span></p>
        </div>
        <div class="product-detail">
          <p><strong>Forma del cuello:</strong> <span>{{ Detalles.tipoCuello }}</span></p>
        </div>
        <div class="product-detail">
          <p><strong>Estilo de la cola:</strong> <span>{{ Detalles.tipoCola }}</span></p>
        </div>


        <div class="product-detail">
          <p><strong>Cantidad:</strong> <span>1</span></p>
        </div>

        <div class="botones">
          <!-- Botones de acción -->
          <button *ngIf="Detalles.disponible"
            (click)="Detalles.opcionesTipoTransaccion == 'renta' ? redirigirContinuarRenta(Detalles._id) : redirigirContinuarCompra(Detalles._id)"
            class="ui add-to-cart rent button" [class.loading]="isLoadingBtn" [class.disabled]="isLoadingBtn">
            {{ Detalles.opcionesTipoTransaccion == 'renta' ? 'Me lo quiero probar' : 'Continuar con la compra' }}
          </button>

          <button (click)="apartarRentar(Detalles)" class="add-to-cart">
            <i class="pi pi-shopping-cart"></i> Agregar a carrito
          </button>

          <!-- Compartir enlace -->
          <div class="share-link">
            <p><strong>Compartir:</strong></p>
            <button class="share-button" title="Compartir enlace">
              <i class="pi pi-share-alt"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="loading-container" *ngIf="!Detalles && isLoading">
    <!-- Contenedor de imágenes -->
    <div class="skeleton-image-section">
      <!-- Columna con 3 tarjetas mini -->
      <div class="skeleton-cards">
        <p-skeleton width="70%" height="70px"></p-skeleton>
        <p-skeleton width="70%" height="70px"></p-skeleton>
        <p-skeleton width="70%" height="70px"></p-skeleton>
      </div>

      <!-- Contenedor grande para imagen principal -->
      <div class="skeleton-container">
        <p-skeleton width="100%" height="400px"></p-skeleton>
      </div>
    </div>

    <!-- Contenedor de información del producto -->
    <div class="loading-container-info">
      <!-- Skeleton para el nombre del producto -->
      <p-skeleton width="100%" height="40px"></p-skeleton>

      <!-- Skeleton para la disponibilidad -->
      <div class="skeleton-availability">
        <p-skeleton width="20px" height="20px" shape="circle"></p-skeleton>
        <p-skeleton width="40%" height="20px"></p-skeleton>
      </div>

      <!-- Skeleton para el precio -->
      <p-skeleton width="30%" height="30px"></p-skeleton>

      <!-- Skeleton para las opciones del producto -->
      <div class="skeleton-options">
        <p-skeleton width="50px" height="20px"></p-skeleton>
        <p-skeleton width="60px" height="30px" shape="circle"></p-skeleton>

        <p-skeleton width="50px" height="20px"></p-skeleton>
        <p-skeleton width="60px" height="30px" shape="circle"></p-skeleton>

        <p-skeleton width="50px" height="20px"></p-skeleton>
        <p-skeleton width="60px" height="30px" shape="circle"></p-skeleton>
      </div>

      <!-- Skeleton para el botón -->
      <p-skeleton width="80%" height="50px" borderRadius="10px"></p-skeleton>

      <!-- Skeleton para compartir enlace -->
      <div class="skeleton-share">
        <p-skeleton width="80px" height="20px"></p-skeleton>
        <p-skeleton width="40px" height="40px" shape="circle"></p-skeleton>
      </div>
    </div>
  </div>
  <div *ngIf="Detalles && !isLoading">
    <h2 class="description-title">Descripción</h2>
    <p class="description-summary">{{ Detalles.descripcion }}</p>
  </div>
  <!-- </div> -->
</div>
<!-- Modal de la imagen en pantalla completa -->
<div class="image-modal" *ngIf="isViewImagen" (click)="closeModal($event)">
  <img #PreviewmainImage (mousemove)="applyZoomEffectPreviewmainImage($event)"
    (mouseleave)="resetZoomEffectPreviewmainImage()" [src]="Detalles.imagenPrincipal" alt="Imagen Ampliada"
    class="modal-image" />
</div>